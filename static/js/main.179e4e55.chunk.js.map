{"version":3,"sources":["Box.js","OrientationLine.js","Skyline.js","App.js","index.js"],"names":["Box","item","factorX","factorY","connectToLastItem","startNewItem","svgHeight","useState","editDialogOpen","setEditDialogOpen","color","setColor","label","setLabel","handleClose","x","position","y","width","duration","height","style","fill","strokeWidth","selected","stroke","onClick","e","altKey","shiftKey","textAnchor","transform","transformOrigin","Dialog","open","onClose","DialogTitle","DialogContent","TextField","size","value","onChange","target","placeholder","DialogActions","Button","OrientationLine","ceiledMaxDuration","className","x1","y1","x2","y2","strokeDasharray","diff","instantsToUnify","acc","index","array","nextInstant","currVal","parseFloat","data","nextVal","isNaN","Skyline","levels","connectedItems","setConnectedItems","lastItem","at","Math","min","prev","slice","newItem","durationLevels","map","level","reduce","current","maxDuration","max","val","ceil","svgWidth","bottom","i","reverse","durations","App","csv","setCSV","setLevels","setFactorX","setFactorY","showHelp","setShowHelp","buttonRef","React","createRef","levelsRef","handleOpenDialog","handleRemoveFile","removeFile","ref","onFileLoad","onError","err","file","inputElem","reason","console","warn","onRemoveFile","variant","name","Tooltip","title","IconButton","inputRef","newLevels","split","l","parseInt","log","type","Drawer","anchor","rootElement","document","getElementById","ReactDOM","render"],"mappings":"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","file":"static/js/main.179e4e55.chunk.js","sourcesContent":["import React, { useState } from \"react\";\nimport {\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField\n} from \"@mui/material\";\n\nconst Box = ({\n  item,\n  factorX,\n  factorY,\n  connectToLastItem,\n  startNewItem,\n  svgHeight\n}) => {\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const [color, setColor] = useState(\"0,0,0,0.3\");\n  const [label, setLabel] = useState(\"\");\n\n  const handleClose = () => setEditDialogOpen(false);\n\n  return (\n    <>\n      <rect\n        x={item.position * factorX}\n        y={0}\n        width={item.duration * factorX}\n        height={item.duration * factorY}\n        style={{\n          fill: `rgba(${color})`,\n          strokeWidth: item.selected ? \"2\" : \"1\",\n          stroke: \"black\"\n        }}\n        onClick={(e) => {\n          if (e.altKey) {\n            setEditDialogOpen(true);\n            return;\n          }\n\n          if (e.shiftKey) connectToLastItem(item);\n          else startNewItem(item);\n        }}\n      />\n\n      <text\n        x={factorX * (item.duration / 2 + item.position)}\n        y={svgHeight - item.duration * factorY - 5}\n        textAnchor=\"middle\"\n        style={{\n          transform: \"scale(1, -1)\",\n          transformOrigin: \"center\"\n        }}\n      >\n        {label}\n      </text>\n\n      <Dialog open={editDialogOpen} onClose={handleClose}>\n        <DialogTitle>Edit Box</DialogTitle>\n\n        <DialogContent>\n          <TextField\n            label=\"Label\"\n            size=\"small\"\n            value={label}\n            onChange={(e) => setLabel(e.target.value)}\n          />\n          <TextField\n            label=\"Color\"\n            size=\"small\"\n            value={color}\n            onChange={(e) => setColor(e.target.value)}\n            placeholder={\"Enter in the form 'r,g,b,a'\"}\n          />\n        </DialogContent>\n\n        <DialogActions>\n          <Button onClick={handleClose}>Close</Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport default Box;\n","import React from \"react\";\n\nconst OrientationLine = ({ ceiledMaxDuration, y, width }) => {\n  return (\n    <>\n      <line\n        className=\"orientationLine\"\n        x1={0.0}\n        y1={y}\n        x2={width}\n        y2={y}\n        stroke=\"black\"\n        strokeDasharray=\"4\"\n      />\n      <text\n        x={0.0}\n        y={40}\n        style={{\n          transform: \"scale(1, -1)\",\n          transformOrigin: \"center\"\n        }}\n      >\n        {ceiledMaxDuration}s\n      </text>\n    </>\n  );\n};\n\nexport default OrientationLine;\n","import React, { useState } from \"react\";\nimport Box from \"./Box\";\nimport OrientationLine from \"./OrientationLine\";\n\nconst diff = (instantsToUnify) => {\n  return (acc, value, index, array) => {\n    const nextInstant = array[index + instantsToUnify];\n    if ((index + instantsToUnify - 1) % instantsToUnify !== 0 || !nextInstant) {\n      return acc;\n    }\n\n    const currVal = parseFloat(value.data[0]);\n    const nextVal = parseFloat(nextInstant.data[0]);\n\n    if (isNaN(currVal)) return acc;\n\n    const duration = {\n      position: currVal,\n      duration: nextVal - currVal,\n      label: value.data[1],\n      selected: false\n    };\n\n    return [...acc, duration];\n  };\n};\n\nconst Skyline = ({ data, levels, factorX, factorY }) => {\n  const [connectedItems, setConnectedItems] = useState([]);\n\n  const connectToLastItem = (item) => {\n    let lastItem = connectedItems.at(-1);\n    lastItem.duration += item.duration;\n    lastItem.position = Math.min(lastItem.position, item.position);\n\n    setConnectedItems((prev) => {\n      return [...prev.slice(0, -1), lastItem];\n    });\n  };\n\n  const startNewItem = (item) => {\n    const newItem = { ...item, selected: true };\n\n    const lastItem = connectedItems.at(-1);\n    if (lastItem) {\n      lastItem.selected = false;\n      setConnectedItems((prev) => [...prev.slice(0, -1), lastItem, newItem]);\n    } else {\n      setConnectedItems((prev) => [...prev, newItem]);\n    }\n  };\n\n  if (!data) {\n    return null;\n  }\n\n  const durationLevels = levels\n    .map((level) => data.reduce(diff(level), []))\n    .reduce((acc, current) => [...acc, current], []);\n\n  const maxDuration = Math.max(\n    ...[\n      ...data.reduce(diff(Math.max(...levels)), []).map((val) => val.duration),\n      ...connectedItems.map((item) => item.duration)\n    ]\n  );\n\n  const ceiledMaxDuration = Math.ceil(maxDuration / 10) * 10;\n  const svgHeight = ceiledMaxDuration * factorY + 50;\n\n  // take last time instant as a reference for the SVG width\n  const svgWidth = data.at(-1).data[0] * factorX;\n\n  return (\n    <svg\n      width={svgWidth}\n      height={svgHeight}\n      style={{\n        bottom: \"1rem\",\n        position: \"absolute\",\n        transform: \"scale(1, -1)\",\n        transformOrigin: \"center\"\n      }}\n    >\n      <g className={`connectedItems`}>\n        {connectedItems.map((item, i) => (\n          <Box\n            key={`connectedItem${i}`}\n            item={item}\n            factorX={factorX}\n            factorY={factorY}\n            connectToLastItem={connectToLastItem}\n            startNewItem={startNewItem}\n            svgHeight={svgHeight}\n          />\n        ))}\n      </g>\n\n      {durationLevels &&\n        durationLevels.reverse().map((durations, level) => (\n          <g key={`durations${level}`} className={`level${level}`}>\n            {durations.map((item, i) => (\n              <Box\n                key={`box${i}`}\n                item={item}\n                factorX={factorX}\n                factorY={factorY}\n                connectToLastItem={connectToLastItem}\n                startNewItem={startNewItem}\n                svgHeight={svgHeight}\n              />\n            ))}\n          </g>\n        ))}\n\n      <OrientationLine\n        ceiledMaxDuration={ceiledMaxDuration}\n        y={ceiledMaxDuration * factorY}\n        width={svgWidth}\n      />\n    </svg>\n  );\n};\n\nexport default Skyline;\n","import React, { useState } from \"react\";\nimport {\n  Drawer,\n  Box,\n  Button,\n  Tooltip,\n  IconButton,\n  TextField\n} from \"@mui/material\";\nimport DeleteIcon from \"@mui/icons-material/Delete\";\nimport { CSVReader } from \"react-papaparse\";\nimport Skyline from \"./Skyline\";\nimport \"./App.css\";\n\nconst App = () => {\n  const [csv, setCSV] = useState(null);\n  const [levels, setLevels] = useState([]);\n  const [factorX, setFactorX] = useState(1);\n  const [factorY, setFactorY] = useState(5);\n  const [showHelp, setShowHelp] = useState(false);\n  const buttonRef = React.createRef();\n  const levelsRef = React.createRef();\n\n  const handleOpenDialog = (e) => {\n    if (buttonRef.current) {\n      buttonRef.current.open(e);\n    }\n  };\n\n  const handleOnError = (err, file, inputElem, reason) => console.warn(err);\n\n  const handleRemoveFile = (e) => {\n    if (buttonRef.current) {\n      buttonRef.current.removeFile(e);\n      setCSV(null);\n    }\n  };\n\n  const handleLevels = () => {\n    if (!levelsRef.current) return;\n\n    const value = levelsRef.current.value;\n    if (!value) {\n      console.log(\"no level specified\");\n      return;\n    }\n\n    const newLevels = value.split(\",\").map((level) => {\n      const l = parseInt(level, 10);\n      if (isNaN(l)) return 0;\n      return l;\n    });\n    setLevels(newLevels);\n  };\n\n  return (\n    <div>\n      <div className=\"options\">\n        <Box>\n          <Button onClick={() => setShowHelp(true)}>How to use?</Button>\n          <CSVReader\n            ref={buttonRef}\n            onFileLoad={setCSV}\n            onError={handleOnError}\n            onRemoveFile={() => {\n              setCSV([]);\n            }}\n          >\n            {({ file }) => (\n              <div className=\"import\">\n                <Button\n                  size=\"smalL\"\n                  variant=\"contained\"\n                  onClick={handleOpenDialog}\n                >\n                  open CSV file\n                </Button>\n                {file && (\n                  <>\n                    <div className=\"filename\">{file && file.name}</div>\n                    <Tooltip title=\"Delete\">\n                      <IconButton onClick={handleRemoveFile}>\n                        <DeleteIcon />\n                      </IconButton>\n                    </Tooltip>\n                  </>\n                )}\n              </div>\n            )}\n          </CSVReader>\n\n          <TextField\n            size=\"small\"\n            label=\"Levels\"\n            placeholder=\"e.g. 1, 3, 6\"\n            inputRef={levelsRef}\n            onChange={handleLevels}\n          />\n\n          <TextField\n            size=\"small\"\n            label=\"Horizontal stretch\"\n            placeholder=\"must be a number\"\n            type=\"number\"\n            value={factorX}\n            onChange={(e) => setFactorX(parseInt(e.target.value, 10))}\n          />\n\n          <TextField\n            size=\"small\"\n            label=\"Vertical stretch\"\n            placeholder=\"must be a number\"\n            value={factorY}\n            type=\"number\"\n            onChange={(e) => setFactorY(parseInt(e.target.value, 10))}\n          />\n        </Box>\n      </div>\n      <Skyline data={csv} levels={levels} factorX={factorX} factorY={factorY} />\n      <Drawer\n        className=\"help\"\n        anchor=\"right\"\n        open={showHelp}\n        onClose={() => setShowHelp(false)}\n      >\n        <p>\n          This tool takes time instants exported as a CSV file from Sonic\n          Visualiser as input.\n        </p>\n        <p>\n          In the \"levels\" field you can specify, how the different metrical\n          layers are combined. When putting \"1\", only the lowest metrical unit\n          is displayed, meaning that every time instant is displayed as a box.\n          When putting \"3\", every <i>third</i> instant is taken into account,\n          meaning that the boxes combine three metrical units. When putting\n          \"1,3\", both metrical layers are being displayed. You can specify an\n          arbitrary amount of layers.\n        </p>\n        <p>\n          In case you want to combine two boxes outside a regular scheme that\n          applies for the whole piece, you can do so be clicking on the first\n          first box, then keeping the shift key down and clicking on an adjecent\n          box. A new box will appear that includes both.\n        </p>\n        <h2>Example</h2>\n        <p>...</p>\n      </Drawer>\n    </div>\n  );\n};\n\nexport default App;\n","import { StrictMode } from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n  rootElement\n);\n"],"sourceRoot":""}